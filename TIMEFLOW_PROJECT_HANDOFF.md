# Timeflow Project - Complete Handoff Documentation

## Project Overview
**Timeflow** is an AI-powered philosophical guidance web app that generates personalized wisdom cards based on emotional states and philosophical lenses.

- **Live URL**: https://timeflow-web.vercel.app/
- **GitHub**: https://github.com/futurisms/timeflow-web
- **Local Path**: `C:\Users\SatnamBains\timeflow-web`

## Tech Stack
- **Framework**: Next.js 16.1.1 (App Router)
- **Styling**: Tailwind CSS
- **AI**: Claude Sonnet 4.5 (Anthropic API)
- **Backend**: Supabase (PostgreSQL + Auth)
- **Deployment**: Vercel
- **Language**: TypeScript

## Current Status (January 11, 2026)

### ‚úÖ Completed Features
1. **User Flow Pages**:
   - Welcome page (`/`)
   - State selection (`/state-selection`)
   - Problem statement (`/problem-statement`)
   - Lens selection (`/lens-selection`)
   - Wisdom card generation (`/wisdom-card`)

2. **AI Integration**:
   - Claude API integrated for wisdom generation
   - Model: `claude-sonnet-4-5-20250929`
   - API endpoint: `/api/generate-wisdom` (Pages Router)
   - Working locally and on Vercel

3. **Authentication**:
   - Supabase Auth integrated
   - Login page: `/auth/login`
   - Signup page: `/auth/signup`
   - Email confirmation enabled
   - Successfully tested locally

4. **Database**:
   - Supabase PostgreSQL database
   - `wisdom_cards` table created
   - Row Level Security (RLS) policies configured
   - Foreign key to `auth.users`

5. **Deployment**:
   - Vercel auto-deployment from GitHub
   - Environment variables configured

### üöß Pending Features
1. **Save Card Functionality**: Wire up "Save Card" button to store wisdom cards in Supabase
2. **My Cards Dashboard**: Create page to view all saved wisdom cards
3. **Navigation/Header**: Add header with user menu and logout
4. **Monetization**: Implement Stripe for 2 free cards, then paid
5. **Polish**: Loading animations, share card as image, mobile optimizations

## Architecture

### File Structure
```
timeflow-web/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                      # Welcome page
‚îÇ   ‚îú‚îÄ‚îÄ state-selection/page.tsx      # State selection
‚îÇ   ‚îú‚îÄ‚îÄ problem-statement/page.tsx    # Problem input
‚îÇ   ‚îú‚îÄ‚îÄ lens-selection/page.tsx       # Philosophical lens selection
‚îÇ   ‚îú‚îÄ‚îÄ wisdom-card/page.tsx          # Wisdom card display
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/page.tsx           # Login page
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ signup/page.tsx          # Signup page
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ generate-wisdom/route.ts # App Router API endpoint
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx                    # Root layout
‚îÇ   ‚îú‚îÄ‚îÄ globals.css                   # Global styles
‚îÇ   ‚îî‚îÄ‚îÄ favicon.ico
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ supabase.ts                   # Supabase client
‚îú‚îÄ‚îÄ public/                           # Static assets
‚îú‚îÄ‚îÄ .env.local                        # Environment variables (not in Git)
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ tailwind.config.ts
‚îî‚îÄ‚îÄ next.config.ts
```

### Database Schema

**Table: `wisdom_cards`**
```sql
CREATE TABLE public.wisdom_cards (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  user_id uuid NULL DEFAULT gen_random_uuid(),
  state text NULL,
  problem text NULL,
  lens text NULL,
  wisdom text NULL,
  CONSTRAINT wisdom_cards_user_id_fkey 
    FOREIGN KEY (user_id) 
    REFERENCES auth.users(id) 
    ON DELETE CASCADE
) TABLESPACE pg_default;

-- Enable Row Level Security
ALTER TABLE wisdom_cards ENABLE ROW LEVEL SECURITY;

-- Policy: Users can view their own cards
CREATE POLICY "Users can view own cards" 
ON wisdom_cards 
FOR SELECT 
USING (auth.uid() = user_id);

-- Policy: Users can insert their own cards
CREATE POLICY "Users can insert own cards" 
ON wisdom_cards 
FOR INSERT 
WITH CHECK (auth.uid() = user_id);

-- Policy: Users can delete their own cards
CREATE POLICY "Users can delete own cards" 
ON wisdom_cards 
FOR DELETE 
USING (auth.uid() = user_id);
```

## Environment Variables

### Local (`.env.local`)
```bash
ANTHROPIC_API_KEY=sk-ant-api03-...
NEXT_PUBLIC_SUPABASE_URL=https://vpmndenronakpxukgyj.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...
```

### Vercel (Production)
Add these in Vercel Dashboard ‚Üí Settings ‚Üí Environment Variables:
- `ANTHROPIC_API_KEY`
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`

Set for: Production, Preview, Development

## Supabase Configuration

### Project Details
- **Organization**: futurisms's Org
- **Project Name**: timeflow-app
- **Database**: PostgreSQL
- **Region**: (User's selection)
- **Project URL**: https://vpmndenronakpxukgyj.supabase.co

### Authentication Settings
**Location**: Authentication ‚Üí Sign In / Providers

- ‚úÖ Allow new users to sign up: **ENABLED**
- ‚úÖ Confirm email: **ENABLED**
- ‚ùå Allow manual linking: DISABLED
- ‚ùå Allow anonymous sign-ins: DISABLED

### URL Configuration
**Location**: Authentication ‚Üí URL Configuration

**Site URL**: `http://localhost:3000` (for local development)

**Redirect URLs**:
- `http://localhost:3000`
- `https://localhost:3000`
- `https://timeflow-web.vercel.app`

### API Keys
**Location**: Settings ‚Üí API

Use the **Legacy anon, service_role API keys** tab:
- **anon key**: Starts with `eyJ`, ~200+ characters
- **service_role key**: Secret, don't use in frontend

## User Flow

1. **Welcome** ‚Üí User clicks "Get Started"
2. **State Selection** ‚Üí User selects emotional state (Rising, Falling, Turbulent, Stuck, Grounded)
3. **Problem Statement** ‚Üí User describes their situation
4. **Lens Selection** ‚Üí User chooses philosophical lens (Stoicism, Buddhism, Existentialism, Taoism, Pragmatism)
5. **Wisdom Card** ‚Üí AI generates personalized wisdom card with:
   - Reflection (2-3 sentences)
   - Key Insight (1 sentence)
   - Practical Action (1 sentence)

## API Endpoints

### `/api/generate-wisdom` (POST)
Generates wisdom card using Claude AI.

**Request Body**:
```json
{
  "state": "falling",
  "problem": "I lost my job",
  "lens": "buddhism"
}
```

**Response**:
```json
{
  "wisdom": "Generated wisdom text..."
}
```

**Implementation** (`app/api/generate-wisdom/route.ts`):
```typescript
import { NextRequest, NextResponse } from 'next/server';

export async function POST(request: NextRequest) {
  try {
    const { state, problem, lens } = await request.json();
    
    const apiKey = process.env.ANTHROPIC_API_KEY;
    if (!apiKey) {
      return NextResponse.json({ error: 'API key not configured' }, { status: 500 });
    }

    const prompt = `You are a wise philosophical guide. A person is experiencing a "${state}" state and shared: "${problem}". Provide guidance through the lens of ${lens}. Structure your response as: 1) A brief reflection (2-3 sentences), 2) Key insight (1 sentence), 3) Practical action (1 sentence). Keep total under 150 words. Be warm, clear, and actionable.`;

    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': apiKey,
        'anthropic-version': '2023-06-01'
      },
      body: JSON.stringify({
        model: 'claude-sonnet-4-5-20250929',
        max_tokens: 1024,
        messages: [{ role: 'user', content: prompt }]
      })
    });

    if (!response.ok) {
      const errorData = await response.json();
      return NextResponse.json({ error: `Claude API error: ${errorData.error?.message}` }, { status: response.status });
    }

    const data = await response.json();
    return NextResponse.json({ wisdom: data.content[0].text });
  } catch (error: any) {
    console.error('Error:', error);
    return NextResponse.json({ error: 'Server error' }, { status: 500 });
  }
}
```

## Authentication Implementation

### Supabase Client (`lib/supabase.ts`)
```typescript
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

export const supabase = createClient(supabaseUrl, supabaseAnonKey);
```

### Login Page (`app/auth/login/page.tsx`)
```typescript
'use client';
import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { supabase } from '@/lib/supabase';
import Link from 'next/link';

export default function Login() {
  const router = useRouter();
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  const handleLogin = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setError(null);

    const { error } = await supabase.auth.signInWithPassword({
      email,
      password,
    });

    if (error) {
      setError(error.message);
      setLoading(false);
    } else {
      router.push('/');
    }
  };

  return (
    <div className="min-h-screen bg-[#faf9f7] flex flex-col items-center justify-center px-8">
      <div className="max-w-md w-full bg-white rounded-3xl shadow-xl p-8">
        <h1 className="text-3xl font-bold text-[#1c1917] mb-2 text-center">Welcome back</h1>
        <p className="text-[#57534e] text-center mb-8">Sign in to access your saved wisdom</p>

        {error && (
          <div className="bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-xl mb-4">
            {error}
          </div>
        )}

        <form onSubmit={handleLogin} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-[#1c1917] mb-2">Email</label>
            <input
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="w-full px-4 py-3 border border-[#e7e5e4] rounded-xl focus:outline-none focus:ring-2 focus:ring-[#292524]"
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-[#1c1917] mb-2">Password</label>
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="w-full px-4 py-3 border border-[#e7e5e4] rounded-xl focus:outline-none focus:ring-2 focus:ring-[#292524]"
              required
            />
          </div>

          <button
            type="submit"
            disabled={loading}
            className="w-full bg-[#292524] text-white py-3 rounded-full font-semibold hover:bg-[#1c1917] transition-all disabled:opacity-50"
          >
            {loading ? 'Signing in...' : 'Sign In'}
          </button>
        </form>

        <p className="text-center text-[#57534e] mt-6">
          Don't have an account?{' '}
          <Link href="/auth/signup" className="text-[#292524] font-semibold hover:underline">
            Sign up
          </Link>
        </p>
      </div>
    </div>
  );
}
```

### Signup Page (`app/auth/signup/page.tsx`)
Similar structure to login, but uses `supabase.auth.signUp()` instead.

## Development Workflow

### Local Development
```bash
# Navigate to project
cd C:\Users\SatnamBains\timeflow-web

# Install dependencies (if needed)
npm install

# Run dev server
npm run dev

# Server runs on http://localhost:3000
```

### Git Workflow
```bash
# Check status
git status

# Add changes
git add .

# Commit
git commit -m "Description of changes"

# Push to GitHub (triggers Vercel deployment)
git push
```

### Vercel Deployment
- **Auto-deploys** on every push to `main` branch
- Check deployment status: https://vercel.com/dashboard
- Each deployment gets a unique preview URL
- Production URL: https://timeflow-web.vercel.app

## Design System

### Colors
- **Background**: `#faf9f7` (warm cream)
- **Text Primary**: `#1c1917` (near black)
- **Text Secondary**: `#57534e` (warm gray)
- **Borders**: `#e7e5e4` (light gray)
- **Buttons**: `#292524` (dark charcoal)

### State Colors (Gradients)
```typescript
const stateColors = {
  rising: 'from-emerald-500 to-emerald-600',
  falling: 'from-red-500 to-red-600',
  turbulent: 'from-amber-500 to-amber-600',
  stuck: 'from-slate-500 to-slate-600',
  grounded: 'from-blue-500 to-blue-600',
};
```

### Lens Icons
```typescript
const lensIcons = {
  stoicism: 'üèõÔ∏è',
  buddhism: '‚ò∏Ô∏è',
  existentialism: 'üé≠',
  taoism: '‚òØÔ∏è',
  pragmatism: 'üîß',
};
```

## Troubleshooting Guide

### CORS Errors with Supabase
**Problem**: "Cross-Origin Request Blocked" error
**Solution**:
1. Verify `.env.local` has complete, correct Supabase URL and anon key
2. Check Supabase URL Configuration has correct redirect URLs
3. Use legacy anon key (starts with `eyJ`), not the new `sb_publishable_` format
4. Hard refresh browser: `Ctrl+Shift+R`
5. Clear browser cache for localhost

### TypeScript Errors on Build
**Problem**: Build fails with TypeScript errors
**Solution**:
1. Check all `searchParams` usage has null checks: `searchParams?.get('key') || ''`
2. Add proper type annotations for state variables
3. Use fallback values: `stateColors[state] || 'from-gray-500 to-gray-600'`

### Environment Variables Not Loading
**Problem**: API keys undefined in production
**Solution**:
1. Verify keys added in Vercel Dashboard ‚Üí Environment Variables
2. Must start with `NEXT_PUBLIC_` for client-side access
3. Redeploy after adding new env vars
4. Check spelling matches exactly

### API Rate Limits
**Claude API**: Check usage at https://console.anthropic.com/
**Supabase Free Tier**:
- 500MB database
- 50,000 monthly active users
- 2GB bandwidth
- 1GB file storage

## Next Steps (Prioritized)

### 1. Save Card Functionality (HIGH PRIORITY)
Wire up the "Save Card" button to store wisdom cards in Supabase.

**What to do**:
- Update `app/wisdom-card/page.tsx`
- Add function to save card to Supabase
- Show success message after save
- Handle errors gracefully

**Code to add**:
```typescript
const handleSaveCard = async () => {
  const { data: { user } } = await supabase.auth.getUser();
  
  if (!user) {
    alert('Please log in to save cards');
    router.push('/auth/login');
    return;
  }

  const { error } = await supabase
    .from('wisdom_cards')
    .insert({
      user_id: user.id,
      state,
      problem,
      lens,
      wisdom
    });

  if (error) {
    alert('Error saving card');
  } else {
    alert('Card saved successfully!');
  }
};
```

### 2. My Cards Dashboard (HIGH PRIORITY)
Create a page to view all saved wisdom cards.

**What to create**:
- New page: `app/my-cards/page.tsx`
- Fetch all cards for logged-in user
- Display cards in a grid
- Add delete functionality
- Add filter/sort options

### 3. Navigation Header (MEDIUM PRIORITY)
Add a header with navigation and user menu.

**What to add**:
- Header component
- Links to: Home, My Cards
- User menu with: Profile, Logout
- Show user email when logged in

### 4. Protected Routes (MEDIUM PRIORITY)
Ensure users must be logged in to save cards.

**What to add**:
- Auth check in wisdom-card page
- Redirect to login if not authenticated
- Show different UI for logged-out users

### 5. Monetization with Stripe (LOW PRIORITY - Future)
Implement payment for wisdom cards after 2 free cards.

**What to implement**:
- Stripe integration
- Track card usage count
- Paywall after 2 cards
- Pricing page
- Subscription management

## Known Issues

1. **HTTPS in Local Development**: HTTPS with self-signed certificates causes issues. Stick with HTTP locally.
2. **Email Confirmation Delay**: Supabase emails can take 1-2 minutes to arrive.
3. **Turbopack Issues**: Next.js 16 with Turbopack occasionally has hot-reload issues. Restart dev server if needed.

## Resources

- **Next.js Docs**: https://nextjs.org/docs
- **Supabase Docs**: https://supabase.com/docs
- **Anthropic API Docs**: https://docs.anthropic.com/
- **Tailwind CSS**: https://tailwindcss.com/docs
- **Vercel Docs**: https://vercel.com/docs

## Contact & Support

- **GitHub Issues**: https://github.com/futurisms/timeflow-web/issues
- **Supabase Support**: https://supabase.com/support
- **Anthropic Support**: https://support.anthropic.com/

---

**Last Updated**: January 11, 2026
**Version**: 1.0
**Status**: Authentication working, ready for save card feature implementation
